/**
 * JustGage - a handy JavaScript plugin for generating and animating nice & clean dashboard gauges.
 * Copyright (C) 2012 - 2013 Bojan Djuricic - pindjur(at)gmail(dot)com | http://www.madcog.com
 * Licensed under MIT.
 * @author Bojan Djuricic (@Toorshia)
 */
JustGage=function(b){var a=this;a.config={id:b.id,parentNode:b.parentNode?b.parentNode:null,width:b.width?b.width:null,height:b.height?b.height:null,title:b.title?b.title:"",titleFontColor:b.titleFontColor?b.titleFontColor:"#999999",value:b.value?b.value:0,valueFontColor:b.valueFontColor?b.valueFontColor:"#010101",symbol:b.symbol?b.symbol:"",min:void 0!==b.min?parseFloat(b.min):0,max:void 0!==b.max?parseFloat(b.max):100,humanFriendlyDecimal:b.humanFriendlyDecimal?b.humanFriendlyDecimal:0,textRenderer:b.textRenderer?
b.textRenderer:null,gaugeWidthScale:b.gaugeWidthScale?b.gaugeWidthScale:1,gaugeColor:b.gaugeColor?b.gaugeColor:"#edebeb",label:b.label?b.label:"",labelFontColor:b.labelFontColor?b.labelFontColor:"#b3b3b3",shadowOpacity:b.shadowOpacity?b.shadowOpacity:0.2,shadowSize:b.shadowSize?b.shadowSize:5,shadowVerticalOffset:b.shadowVerticalOffset?b.shadowVerticalOffset:3,levelColors:b.levelColors?b.levelColors:["#a9d70b","#f9c802","#ff0000"],startAnimationTime:b.startAnimationTime?b.startAnimationTime:700,startAnimationType:b.startAnimationType?
b.startAnimationType:">",refreshAnimationTime:b.refreshAnimationTime?b.refreshAnimationTime:700,refreshAnimationType:b.refreshAnimationType?b.refreshAnimationType:">",donutStartAngle:void 0!==b.donutStartAngle?b.donutStartAngle:90,valueMinFontSize:b.valueMinFontSize||16,titleMinFontSize:b.titleMinFontSize||10,labelMinFontSize:b.labelMinFontSize||10,minLabelMinFontSize:b.minLabelMinFontSize||10,maxLabelMinFontSize:b.maxLabelMinFontSize||10,hideValue:b.hideValue?b.hideValue:!1,hideMinMax:b.hideMinMax?
b.hideMinMax:!1,hideInnerShadow:b.hideInnerShadow?b.hideInnerShadow:!1,humanFriendly:b.humanFriendly?b.humanFriendly:!1,noGradient:b.noGradient?b.noGradient:!1,donut:b.donut?b.donut:!1,relativeGaugeSize:b.relativeGaugeSize?b.relativeGaugeSize:!1,counter:b.counter?b.counter:!1,decimals:b.decimals?b.decimals:0,customSectors:b.customSectors?b.customSectors:[]};var c,e,d,k,f,h,l,g,t,r,u,p,s,v,n,w,x,y,z,A;a.config.value>a.config.max&&(a.config.value=a.config.max);a.config.value<a.config.min&&(a.config.value=
a.config.min);a.originalValue=b.value;null!==a.config.id&&null!==document.getElementById(a.config.id)?a.canvas=Raphael(a.config.id,"100%","100%"):null!==a.config.parentNode&&(a.canvas=Raphael(a.config.parentNode,"100%","100%"));!0===a.config.relativeGaugeSize&&a.canvas.setViewBox(0,0,200,150,!0);!0===a.config.relativeGaugeSize?(b=200,c=150):null!==a.config.width&&null!==a.config.height?(b=a.config.width,c=a.config.height):null!==a.config.parentNode?(a.canvas.setViewBox(0,0,200,150,!0),b=200,c=150):
(b=1*getStyle(document.getElementById(a.config.id),"width").slice(0,-2),c=1*getStyle(document.getElementById(a.config.id),"height").slice(0,-2));!0===a.config.donut?(b>c?e=d=c:b<c?(d=e=b,d>c&&(k=d/c,d/=k,e=d/k)):d=e=b,f=(b-e)/2,h=(c-d)/2,l=10<d/8?d/10:10,g=f+e/2,t=h+d/11,r=16<d/6.4?d/5.4:18,u=f+e/2,p=""!==a.config.label?h+d/1.85:h+d/1.7,s=10<d/16?d/16:10,v=f+e/2,n=p+s,w=10<d/16?d/16:10,x=f+e/10+e/6.666666666666667*a.config.gaugeWidthScale/2,y=n,z=10<d/16?d/16:10):(b>c?(d=c,e=1.25*d,e>b&&(k=e/b,e/=
k,d/=k)):b<c?(e=b,d=e/1.25,d>c&&(k=d/c,d/=k,e=d/k)):(e=b,d=0.75*e),f=(b-e)/2,h=(c-d)/2,l=d/8>a.config.titleMinFontSize?d/10:a.config.titleMinFontSize,g=f+e/2,t=h+d/6.4,r=d/6.5>a.config.valueMinFontSize?d/6.5:a.config.valueMinFontSize,u=f+e/2,p=h+d/1.275,s=d/16>a.config.labelMinFontSize?d/16:a.config.labelMinFontSize,v=f+e/2,n=p+r/2+5,w=d/16>a.config.minLabelMinFontSize?d/16:a.config.minLabelMinFontSize,x=f+e/10+e/6.666666666666667*a.config.gaugeWidthScale/2,y=n,z=d/16>a.config.maxLabelMinFontSize?
d/16:a.config.maxLabelMinFontSize);A=f+e-e/10-e/6.666666666666667*a.config.gaugeWidthScale/2;a.params={canvasW:b,canvasH:c,widgetW:e,widgetH:d,dx:f,dy:h,titleFontSize:l,titleX:g,titleY:t,valueFontSize:r,valueX:u,valueY:p,labelFontSize:s,labelX:v,labelY:n,minFontSize:w,minX:x,minY:y,maxFontSize:z,maxX:A,maxY:n};b;c;e;d;k;f;h;l;g;t;r;u;p;s;v;n;w;x;y;z;A;a.canvas.customAttributes.pki=function(a,b,d,c,e,k,g,f,h){var l,q,n,p,m;h?(l=(1-2*(a-b)/(d-b))*Math.PI,h=c/2-c/7,f=h-c/6.666666666666667*f,q=c/2+k,
g=e/1.95+g,n=c/2+k+h*Math.cos(l),p=e-(e-g)+0-h*Math.sin(l),c=c/2+k+f*Math.cos(l),e=e-(e-g)+0-f*Math.sin(l),m=m+("M"+(q-f)+","+g+" ")+("L"+(q-h)+","+g+" "),a>(d-b)/2&&(m+="A"+h+","+h+" 0 0 1 "+(q+h)+","+g+" "),m+="A"+h+","+h+" 0 0 1 "+n+","+p+" ",m+="L"+c+","+e+" ",a>(d-b)/2&&(m+="A"+f+","+f+" 0 0 0 "+(q+f)+","+g+" ")):(l=(1-(a-b)/(d-b))*Math.PI,h=c/2-c/10,f=h-c/6.666666666666667*f,q=c/2+k,g=e/1.25+g,n=c/2+k+h*Math.cos(l),p=e-(e-g)+0-h*Math.sin(l),c=c/2+k+f*Math.cos(l),e=e-(e-g)+0-f*Math.sin(l),m+=
"M"+(q-f)+","+g+" ",m+="L"+(q-h)+","+g+" ",m+="A"+h+","+h+" 0 0 1 "+n+","+p+" ",m+="L"+c+","+e+" ");m+="A"+f+","+f+" 0 0 0 "+(q-f)+","+g+" ";m+="Z ";return{path:m}};a.gauge=a.canvas.path().attr({stroke:"none",fill:a.config.gaugeColor,pki:[a.config.max,a.config.min,a.config.max,a.params.widgetW,a.params.widgetH,a.params.dx,a.params.dy,a.config.gaugeWidthScale,a.config.donut]});a.level=a.canvas.path().attr({stroke:"none",fill:getColor(a.config.value,(a.config.value-a.config.min)/(a.config.max-a.config.min),
a.config.levelColors,a.config.noGradient,a.config.customSectors),pki:[a.config.min,a.config.min,a.config.max,a.params.widgetW,a.params.widgetH,a.params.dx,a.params.dy,a.config.gaugeWidthScale,a.config.donut]});a.config.donut&&a.level.transform("r"+a.config.donutStartAngle+", "+(a.params.widgetW/2+a.params.dx)+", "+(a.params.widgetH/1.95+a.params.dy));a.txtTitle=a.canvas.text(a.params.titleX,a.params.titleY,a.config.title);a.txtTitle.attr({"font-size":a.params.titleFontSize,"font-weight":"bold","font-family":"Arial",
fill:a.config.titleFontColor,"fill-opacity":"1"});setDy(a.txtTitle,a.params.titleFontSize,a.params.titleY);a.txtValue=a.canvas.text(a.params.valueX,a.params.valueY,0);a.txtValue.attr({"font-size":a.params.valueFontSize,"font-weight":"bold","font-family":"Arial",fill:a.config.valueFontColor,"fill-opacity":"0"});setDy(a.txtValue,a.params.valueFontSize,a.params.valueY);a.txtLabel=a.canvas.text(a.params.labelX,a.params.labelY,a.config.label);a.txtLabel.attr({"font-size":a.params.labelFontSize,"font-weight":"normal",
"font-family":"Arial",fill:a.config.labelFontColor,"fill-opacity":"0"});setDy(a.txtLabel,a.params.labelFontSize,a.params.labelY);a.txtMinimum=a.config.min;a.config.humanFriendly&&(a.txtMinimum=humanFriendlyNumber(a.config.min,a.config.humanFriendlyDecimal));a.txtMin=a.canvas.text(a.params.minX,a.params.minY,a.txtMinimum);a.txtMin.attr({"font-size":a.params.minFontSize,"font-weight":"normal","font-family":"Arial",fill:a.config.labelFontColor,"fill-opacity":a.config.hideMinMax||a.config.donut?"0":"1"});
setDy(a.txtMin,a.params.minFontSize,a.params.minY);a.txtMaximum=a.config.max;a.config.humanFriendly&&(a.txtMaximum=humanFriendlyNumber(a.config.max,a.config.humanFriendlyDecimal));a.txtMax=a.canvas.text(a.params.maxX,a.params.maxY,a.txtMaximum);a.txtMax.attr({"font-size":a.params.maxFontSize,"font-weight":"normal","font-family":"Arial",fill:a.config.labelFontColor,"fill-opacity":a.config.hideMinMax||a.config.donut?"0":"1"});setDy(a.txtMax,a.params.maxFontSize,a.params.maxY);var B=a.canvas.canvas.childNodes[1],
C="http://www.w3.org/2000/svg";9>ie?onCreateElementNsReady(function(){a.generateShadow(C,B)}):a.generateShadow(C,B);B;C=null;a.originalValue=a.config.textRenderer?a.config.textRenderer(a.originalValue):a.config.humanFriendly?humanFriendlyNumber(a.originalValue,a.config.humanFriendlyDecimal)+a.config.symbol:(1*a.originalValue).toFixed(a.config.decimals)+a.config.symbol;if(!0===a.config.counter)eve.on("raphael.anim.frame."+a.level.id,function(){var b=a.level.attr("pki");a.config.textRenderer?a.txtValue.attr("text",
a.config.textRenderer(Math.floor(b[0]))):a.config.humanFriendly?a.txtValue.attr("text",humanFriendlyNumber(Math.floor(b[0]),a.config.humanFriendlyDecimal)+a.config.symbol):a.txtValue.attr("text",(1*b[0]).toFixed(a.config.decimals)+a.config.symbol);setDy(a.txtValue,a.params.valueFontSize,a.params.valueY)}),eve.on("raphael.anim.finish."+a.level.id,function(){a.txtValue.attr({text:a.originalValue});setDy(a.txtValue,a.params.valueFontSize,a.params.valueY)});else eve.on("raphael.anim.start."+a.level.id,
function(){a.txtValue.attr({text:a.originalValue});setDy(a.txtValue,a.params.valueFontSize,a.params.valueY)});a.level.animate({pki:[a.config.value,a.config.min,a.config.max,a.params.widgetW,a.params.widgetH,a.params.dx,a.params.dy,a.config.gaugeWidthScale,a.config.donut]},a.config.startAnimationTime,a.config.startAnimationType);a.txtValue.animate({"fill-opacity":a.config.hideValue?"0":"1"},a.config.startAnimationTime,a.config.startAnimationType);a.txtLabel.animate({"fill-opacity":"1"},a.config.startAnimationTime,
a.config.startAnimationType)};
JustGage.prototype.refresh=function(b,a){var c,e;a=a||null;null!==a&&(this.config.max=a,this.txtMaximum=this.config.max,this.config.humanFriendly&&(this.txtMaximum=humanFriendlyNumber(this.config.max,this.config.humanFriendlyDecimal)),this.txtMax.attr({text:this.txtMaximum}),setDy(this.txtMax,this.params.maxFontSize,this.params.maxY));c=b;1*b>1*this.config.max&&(b=1*this.config.max);1*b<1*this.config.min&&(b=1*this.config.min);e=getColor(b,(b-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,
this.config.noGradient,this.config.customSectors);this.originalValue=c=this.config.textRenderer?this.config.textRenderer(c):this.config.humanFriendly?humanFriendlyNumber(c,this.config.humanFriendlyDecimal)+this.config.symbol:(1*c).toFixed(this.config.decimals)+this.config.symbol;this.config.value=1*b;this.config.counter||(this.txtValue.attr({text:c}),setDy(this.txtValue,this.params.valueFontSize,this.params.valueY));this.level.animate({pki:[this.config.value,this.config.min,this.config.max,this.params.widgetW,
this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale,this.config.donut],fill:e},this.config.refreshAnimationTime,this.config.refreshAnimationType);this;c;e};
JustGage.prototype.generateShadow=function(b,a){var c,e,d,k,f,h,l;c=document.createElementNS(b,"filter");c.setAttribute("id","inner-shadow");a.appendChild(c);e=document.createElementNS(b,"feOffset");e.setAttribute("dx",0);e.setAttribute("dy",this.config.shadowVerticalOffset);c.appendChild(e);d=document.createElementNS(b,"feGaussianBlur");d.setAttribute("result","offset-blur");d.setAttribute("stdDeviation",this.config.shadowSize);c.appendChild(d);k=document.createElementNS(b,"feComposite");k.setAttribute("operator",
"out");k.setAttribute("in","SourceGraphic");k.setAttribute("in2","offset-blur");k.setAttribute("result","inverse");c.appendChild(k);f=document.createElementNS(b,"feFlood");f.setAttribute("flood-color","black");f.setAttribute("flood-opacity",this.config.shadowOpacity);f.setAttribute("result","color");c.appendChild(f);h=document.createElementNS(b,"feComposite");h.setAttribute("operator","in");h.setAttribute("in","color");h.setAttribute("in2","inverse");h.setAttribute("result","shadow");c.appendChild(h);
l=document.createElementNS(b,"feComposite");l.setAttribute("operator","over");l.setAttribute("in","shadow");l.setAttribute("in2","SourceGraphic");c.appendChild(l);this.config.hideInnerShadow||(this.canvas.canvas.childNodes[2].setAttribute("filter","url(#inner-shadow)"),this.canvas.canvas.childNodes[3].setAttribute("filter","url(#inner-shadow)"));c;e;d;k;f;h};
function getColor(b,a,c,e,d){var k,f,h,l,g;e=e||0<d.length;if(0<d.length)for(g=0;g<d.length;g++)if(b>d[g].lo&&b<=d[g].hi)return d[g].color;b=c.length;if(1===b)return c[0];d=e?1/b:1/(b-1);b=[];for(g=0;g<c.length;g++)k=e?d*(g+1):d*g,f=parseInt(cutHex(c[g]).substring(0,2),16),h=parseInt(cutHex(c[g]).substring(2,4),16),l=parseInt(cutHex(c[g]).substring(4,6),16),b[g]={pct:k,color:{r:f,g:h,b:l}};if(0===a)return"rgb("+[b[0].color.r,b[0].color.g,b[0].color.b].join()+")";for(c=0;c<b.length;c++)if(a<=b[c].pct){if(e)return"rgb("+
[b[c].color.r,b[c].color.g,b[c].color.b].join()+")";e=b[c-1];c=b[c];b=c.pct-e.pct;a=(a-e.pct)/b;g=1-a;d=a;a=Math.floor(e.color.r*g+c.color.r*d);b=Math.floor(e.color.g*g+c.color.g*d);e=Math.floor(e.color.b*g+c.color.b*d);return"rgb("+[a,b,e].join()+")"}}function setDy(b,a,c){if(!ie||9<ie)b.node.firstChild.attributes.dy.value=0}function getRandomInt(b,a){return Math.floor(Math.random()*(a-b+1))+b}function cutHex(b){return"#"==b.charAt(0)?b.substring(1,7):b}
function humanFriendlyNumber(b,a){var c,e,d,k;c=Math.pow;e=c(10,a);for(d=7;d;)k=c(10,3*d--),k<=b&&(b=Math.round(b*e/k)/e+"KMGTPE"[d]);return b}function getStyle(b,a){var c="";document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(b,"").getPropertyValue(a):b.currentStyle&&(a=a.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=b.currentStyle[a]);return c}
function onCreateElementNsReady(b){void 0!==document.createElementNS?b():setTimeout(function(){onCreateElementNsReady(b)},100)}var ie=function(){for(var b=3,a=document.createElement("div"),c=a.getElementsByTagName("i");a.innerHTML="\x3c!--[if gt IE "+ ++b+"]><i></i><![endif]--\x3e",c[0];);return 4<b?b:void 0}();
